<?php
/**
 * 個別支援計画書生成テスト（ダミーデータ）
 */
session_start();
require_once __DIR__ . '/../config/database.php';

// 認証チェック
if (!isset($_SESSION['user_id']) || $_SESSION['user_type'] !== 'staff') {
    header('Location: ../login.php');
    exit;
}

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    header('Location: kobetsu_plan.php');
    exit;
}

$studentId = $_POST['student_id'] ?? null;

// テストデータを直接セッションに保存
$_SESSION['generated_plan'] = [
    'life_intention' => '本人は友達と一緒に遊ぶことを楽しみにしており、家族は集団生活の中で安心して過ごせることを願っています。また、自分の気持ちを言葉で伝えられるようになることで、より豊かなコミュニケーションができることを期待しています。',
    'overall_policy' => '本人の興味・関心を大切にしながら、友達との関わりを通じて社会性を育んでいきます。視覚支援や構造化された環境を活用し、見通しを持って安心して活動できるよう支援します。また、スモールステップで成功体験を積み重ね、自己肯定感を高めていきます。',
    'long_term_goal_text' => '集団活動の中で、友達と協力して遊びや課題に取り組むことができる。自分の気持ちや要求を、相手に分かりやすく言葉で伝えることができる。',
    'short_term_goal_text' => '好きな遊びの場面で、友達と簡単なやり取り（貸して・どうぞなど）ができる。困った時や助けてほしい時に、大人に言葉で伝えることができる。',
    'details' => [
        [
            'category' => '本人支援',
            'sub_category' => '生活習慣（健康・生活）',
            'support_goal' => '朝の準備（着替え・手洗い）を、視覚支援ツールを見ながら自分で行うことができる',
            'support_content' => '毎日の登園時に、写真入りの手順表を使用して朝の準備の流れを確認します。①ロッカーに荷物を入れる ②上着を脱いでハンガーにかける ③手洗い・うがいをする ④出席カードにシールを貼る の4段階を設定します。最初は保育士が一緒に手順表を指差しながら確認し、できたらシールを貼って達成感を感じられるようにします。1週間ごとに支援の度合いを減らし、声かけのみ、最終的には自立を目指します。成功した時は具体的に褒め、次への意欲につなげます。',
            'staff_organization' => "保育士\n児童指導員",
            'notes' => '体調や気分により取り組みが難しい日もあるため、無理強いせず柔軟に対応します。できた部分を認め、小さな成功を積み重ねることを重視します。'
        ],
        [
            'category' => '本人支援',
            'sub_category' => 'コミュニケーション（言語・コミュニケーション）',
            'support_goal' => '要求や困りごとを、2語文以上の言葉で伝えることができる',
            'support_content' => '日常の様々な場面で、本人が伝えたいことを言語化する支援を行います。遊びの時間には「○○貸して」「一緒に遊ぼう」、困った時には「手伝って」「分からない」などのフレーズを、絵カードと組み合わせて提示します。最初は保育士が見本を示し、本人が真似して言えたら要求を叶えることで成功体験を積みます。徐々にヒントを減らし、自発的に言えるよう促していきます。コミュニケーションが成功した経験を増やすことで、言葉で伝える意欲を高めます。週1回、個別の時間を設けて、絵カードを使った練習も行います。',
            'staff_organization' => "保育士\n児童指導員\n言語聴覚士（月1回）",
            'notes' => '無理に発話を促すとプレッシャーになるため、本人のペースを尊重します。ジェスチャーや指差しも受け入れながら、徐々に言葉を添えていくアプローチをとります。'
        ],
        [
            'category' => '本人支援',
            'sub_category' => '社会性（人間関係・社会性）',
            'support_goal' => '好きな遊びの中で、友達と順番を守ってやり取りすることができる',
            'support_content' => '本人が興味を持っているブロック遊びや電車遊びの場面を活用し、友達との関わりを段階的に支援します。最初は保育士が仲介役となり、「順番ね」「次は○○ちゃん」と視覚的なタイマーや順番カードを使って明確に示します。待つ間は砂時計を使い、「砂が落ちたら交代だよ」と見通しを持たせます。できたら「順番守れたね」と具体的に褒めます。徐々に保育士の介入を減らし、2人きりでのやり取りができるよう支援します。毎日の自由遊び時間（30分）に、意図的に友達との関わりの場面を設定します。',
            'staff_organization' => "保育士\n児童指導員",
            'notes' => '本人の気持ちが高ぶっている時や、友達とのトラブルが予想される時は、早めに介入して安全な環境を保ちます。成功体験を重視し、無理なく進めます。'
        ],
        [
            'category' => '本人支援',
            'sub_category' => '運動・感覚（運動・感覚）',
            'support_goal' => '身体を使った遊び（トランポリン・ボール遊びなど）を、安全に楽しむことができる',
            'support_content' => '感覚統合の観点から、毎日15分程度の運動遊びの時間を設けます。トランポリンでは「10回跳んだら終わり」と数を決めて見通しを持たせ、跳ぶリズムに合わせて「1、2、3...」と数を数えます。ボール遊びでは、転がす・投げる・蹴るなど段階を追って取り組みます。バランスボールやトンネルくぐりなども取り入れ、楽しみながら体幹を鍛えます。運動の前後には、始まりと終わりの合図（手拍子や音楽）を使って切り替えをサポートします。感覚の過敏性や鈍麻に配慮し、無理のない範囲で取り組みます。',
            'staff_organization' => "保育士\n児童指導員\n作業療法士（月2回）",
            'notes' => '感覚過敏がある場合は、音や触覚に配慮します。疲れが見られたら無理せず休憩を取り、本人のペースを大切にします。'
        ],
        [
            'category' => '本人支援',
            'sub_category' => '学習（認知・行動）',
            'support_goal' => '簡単なマッチング課題（色・形・絵カード）を、集中して取り組むことができる',
            'support_content' => '個別の学習時間（週3回、各20分）を設定し、本人の発達段階に合わせた課題に取り組みます。色のマッチング（赤・青・黄）から始め、できるようになったら形や動物の絵カードへと段階を上げます。視覚的に分かりやすい教材を使用し、「この色とおなじ色はどれ？」と具体的に問いかけます。タイマーを使って課題の見通しを持たせ、終わったらご褒美シールを貼ります。5分×4セットの構造で、飽きずに集中できるよう工夫します。正解したら大いに褒め、間違えても「もう一回やってみよう」と前向きに声かけします。',
            'staff_organization' => "保育士\n児童指導員",
            'notes' => '集中力が続かない時は無理に続けず、短時間でも成功体験を積むことを優先します。本人の興味に合わせて教材を工夫します。'
        ],
        [
            'category' => '家族支援',
            'sub_category' => '保護者支援',
            'support_goal' => '保護者が家庭でも実践できる具体的な関わり方を理解し、安心して子育てができる',
            'support_content' => '月1回の保護者面談で、施設での様子を写真や動画で共有し、具体的な成長を伝えます。家庭でも使える視覚支援ツール（朝の準備表、歯磨き手順表など）を提供し、使い方を丁寧に説明します。保護者の困りごとや不安に寄り添い、「こういう時はこうしてみては」と具体的なアドバイスを提供します。連絡帳では、その日の良かった場面を中心に伝え、保護者が前向きな気持ちで子育てできるよう配慮します。必要に応じて、地域の相談機関や親の会などの情報も提供します。保護者同士の交流の機会（保護者会、季節のイベント）も設けます。',
            'staff_organization' => "児童発達支援管理責任者\n保育士",
            'notes' => '保護者の気持ちに寄り添い、否定的な言葉は避けます。小さな成長も見逃さず伝え、保護者の頑張りを認める姿勢を大切にします。'
        ],
        [
            'category' => '地域支援',
            'sub_category' => '関係機関連携',
            'support_goal' => '保育園や療育機関と定期的に情報共有を行い、一貫した支援を提供する',
            'support_content' => '在籍する保育園とは月1回の情報交換会を実施し、本人の様子や支援方法を共有します。保育園での困りごとに対して、視覚支援の方法や声かけの工夫などを提案します。必要に応じて保育園を訪問し、環境設定や支援方法について直接アドバイスします。医療機関（小児科、発達外来）とは、診断書や意見書を通じて情報共有を行い、専門的な見解を支援に活かします。他の療育機関（作業療法、言語療法）とも定期的に連絡を取り、支援の方向性を統一します。年2回のケース会議を開催し、関係者全員で支援計画を確認・見直します。',
            'staff_organization' => "児童発達支援管理責任者",
            'notes' => '情報共有の際は、保護者の同意を得て、個人情報の取り扱いに十分注意します。各機関の役割を明確にし、連携がスムーズに進むよう調整します。'
        ]
    ]
];

$_SESSION['success'] = 'テストデータを生成しました。内容を確認・編集して保存してください。';

header("Location: kobetsu_plan.php?student_id=$studentId");
exit;
