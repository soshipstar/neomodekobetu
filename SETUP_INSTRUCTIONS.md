# セットアップ手順

## 1. 管理者アカウントの作成

現在、`admin / admin123` でログインするとスタッフページに移動する問題があります。
この問題を修正するため、以下の手順で管理者アカウントを作成してください。

### 方法1: PHPスクリプトを実行（推奨）

ブラウザで以下のURLにアクセスしてください：

```
http://localhost/kobetu/create_admin_accounts.php
```

実行後、以下のアカウントが作成/修正されます：

| ユーザー名 | パスワード | 権限 | is_master |
|-----------|-----------|------|-----------|
| master | master123 | マスター管理者 | 1 |
| administrator | admin123 | 通常管理者 | 0 |
| admin | admin123 | 通常管理者（修正済み） | 0 |

### 方法2: SQLを直接実行

phpMyAdminまたはMySQLクライアントで `create_admin_accounts.sql` を実行してください。

## 2. ログインテスト

アカウント作成後、以下のアカウントでログインをテストしてください：

1. **マスター管理者でログイン**
   - ユーザー名: `master`
   - パスワード: `master123`
   - 期待される動作: 管理者ページ（admin/index.php）に移動

2. **通常管理者でログイン**
   - ユーザー名: `administrator`
   - パスワード: `admin123`
   - 期待される動作: 管理者ページ（admin/index.php）に移動

3. **既存管理者でログイン（修正済み）**
   - ユーザー名: `admin`
   - パスワード: `admin123`
   - 期待される動作: 管理者ページ（admin/index.php）に移動

すべてのアカウントが正しく管理者ページに移動することを確認してください。

## 3. 完了した機能

### ✅ 個別支援計画のAI生成改善
- 五領域を施設内支援に特化
- 支援目標を100-120文字に詳細化
- 自動日付計算（かけはし期限+1日が作成日、+1年が長期目標達成時期、+6ヶ月が短期目標達成時期）
- 「AI自動生成」→「かけはしを分析」に表記変更

### ✅ PDF出力機能
- 個別支援計画のPDF出力が可能
- カテゴリー別の色分け表示

### ✅ 生徒管理機能強化（管理者画面）
- ステータス選択: 在籍・体験・退所
- 生徒データ削除機能（関連データ一括削除）

### ✅ 教室情報設定機能
- 教室名・住所・電話番号・ロゴの登録
- 保護者画面に教室情報を表示

### ✅ データベース拡張
- classroomsテーブル作成
- studentsテーブルにstatus, classroom_id追加
- usersテーブルにis_master, classroom_id追加

## 4. 完了した機能（追加分）

### ✅ マスター管理者機能
- マスター管理者と通常管理者の権限分離
- マスター管理者専用メニュー（★マスター専用バッジ付き）
- 教室管理機能（新規作成・編集・削除、ロゴアップロード）
- 管理者アカウント管理機能（作成・編集・削除、教室割り当て）
- 通常管理者の権限制限（自分の教室のデータのみ表示・編集）

### マスター管理者で使える機能
1. **教室管理** (`admin/classrooms.php`)
   - 全教室の一覧表示（管理者数・生徒数も表示）
   - 新規教室の登録（教室名・住所・電話番号・ロゴ）
   - 教室情報の編集
   - 教室の削除（関連データも一括削除）

2. **管理者アカウント管理** (`admin/admin_accounts.php`)
   - 全管理者アカウントの一覧表示
   - 新規管理者の登録（通常管理者・マスター管理者を選択可能）
   - 管理者情報の編集（権限変更、教室変更、無効化など）
   - 管理者アカウントの削除

3. **生徒・保護者管理**
   - 全教室の生徒・保護者を表示・管理可能

### 通常管理者で使える機能
1. **自分の教室のみのデータ管理**
   - 生徒管理：自分の教室の生徒のみ表示・編集
   - 保護者管理：自分の教室の保護者のみ表示・編集
   - 新規登録時は自動的に自分の教室に紐付け

2. **教室情報設定** (`admin/classroom_settings.php`)
   - 自分の教室の情報のみ編集可能

## 5. 未実装の機能（今後の作業）

### 🔲 スタッフ画面に教室情報表示
- スタッフ画面のヘッダーに教室ロゴと教室名を表示

## 6. トラブルシューティング

### Q: create_admin_accounts.phpにアクセスできない
A: XAMPPが起動していることを確認してください。Apache Webサーバーが動作している必要があります。

### Q: ログイン後もスタッフページに移動する
A: データベースのusersテーブルを確認してください。user_type列が'admin'、is_master列が適切に設定されているか確認が必要です。

### Q: 教室ロゴが表示されない
A: uploadsディレクトリに書き込み権限があるか確認してください。また、アップロードしたファイルが2MB以下の画像ファイル（JPEG, PNG, GIF）であることを確認してください。
